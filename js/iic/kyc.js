function switchLang4Kyc(e){switchLang(e),$("input[name=idName]").attr("placeholder",$.i18n("name_different_warning")),$("input[name=idNum]").attr("placeholder",$.i18n("id_number")),$("input[name=activeCode]").attr("placeholder",$.i18n("placeholder_activecode")),$("input[name=ethAddress]").attr("placeholder",$.i18n("placeholder_eth_address")),$("input[name=phoneNum]").attr("placeholder",$.i18n("placeholder_phonenum"))}function checkRealName(e){return""===$.trim(e)&&$.i18n("check_error_real_name")}function checkID(e){return!/\d{3,}/gi.test(e)&&$.i18n("check_error_id")}function checkPhoneNum(e){return!/\d{3,}/gi.test(e)&&$.i18n("check_error_phone")}function checkImage(){var e=!0;return $("input[name=fileIdFront]").val()?$("input[name=fileIdFront]").parent().next("div.with-errors").html(""):($("input[name=fileIdFront]").parent().next("div.with-errors").html($.i18n("image_warning3")),e=!1),$("input[name=fileIdBack]").val()?$("input[name=fileIdBack]").parent().next("div.with-errors").html(""):($("input[name=fileIdBack]").parent().next("div.with-errors").html($.i18n("image_warning3")),e=!1),$("input[name=fileInHand]").val()?$("input[name=fileInHand]").parent().next("div.with-errors").html(""):($("input[name=fileInHand]").parent().next("div.with-errors").html($.i18n("image_warning3")),e=!1),e}function checkProtocal(){var e=!0;return $("input[type=checkbox]").is(":checked")?$("input[type=checkbox]").parent().next("div.with-errors").html():($("input[type=checkbox]").parent().next("div.with-errors").html($.i18n("protocol_warning")),e=!1),e}function uploadImage(){var e=$(this)[0].files[0];if(e){if(e.size&&e.size/1e6>10)return void $(this).parent().next(".help-block.with-errors").html($.i18n("image_warning1"));if(e.name&&-1==["jpg","jpeg","png","gif"].indexOf(e.name.split(".").pop().toLowerCase()))return void $(this).parent().next(".help-block.with-errors").html($.i18n("image_warning2"));var t=new FormData;t.append("file",e),$.ajax({context:this,method:"POST",url:KYC_UPLOAD_URL,headers:{Authorization:"Bearer "+getToken()},contentType:!1,processData:!1,data:t,success:function(e){$(this).parent().children(".upload-image").css("background-image","url("+e.data+")"),$(this).parent().children("input[type=text]").val(e.data),$(this).next("upload-image-text").html($.i18n("change_image_title"))},error:function(e,t,n){e.status}})}}function bindEvent(){var e=COUNTRY_MAP.map(function(e){return'<option value="'+e.langKey+","+e.areaCode+'">+'+e.areaCode+"  "+e.value+"</option>"}).join("");$("select").html(e),$("input[name=idName]").on("blur",function(e){var t=$(this),n=checkRealName(t.val());showErr(t,n)}),$("input[name=idNum]").on("blur",function(e){var t=$(this),n=checkID(t.val());showErr(t,n)}),$("input[name=phoneNum]").on("blur",function(e){var t=$(this),n=checkPhoneNum(t.val());showErr(t,n)}),$(".btn-send-code").on("click",function(e){var t=$(this),n=checkPhone($("input[name=phoneNum]").val());if(n)return void $("input[name=phoneNum]").siblings(".with-errors").text(n);$("input[name=phoneNum]").siblings(".with-errors").text("");var a=t.text();countDown({el:t,duration:60,cb:function(){t.text(a)}});$("input[name=phoneNum]").siblings(".with-errors").text("SMS code has been sended, please check it out...");var i=$("#kyc").serializeJSON();i.mobilePhoneAreaCode=i.nationality.split(",")[1],i.areaCode=i.nationality.split(",")[1],i.langKey=i.nationality.split(",")[0],sendKycSms({url:KYC_PHONE,pram:i})}),$("input[name=activeCode]").on("blur",function(e){var t=$(this),n=checkVerfyCode(t.val());showErr(t,n)}),$("input[name=ethAddress]").on("blur",function(e){var t=$(this),n="";isAddress(t.val())||(n=$.i18n("check_error_eth")),showErr(t,n)}),$(".btn-submit").on("click",function(e){e.preventDefault();$(this);$.each($("#kyc").find("input"),function(e,t){$(t).trigger("blur")}),$.each($(".uploadImg"),function(e,t){"1"!==$(t).attr("isupload")&&$(t).siblings(".with-errors").text("please upload image...")});var t="";if($.each($("#kyc").find(".with-errors"),function(e,n){""!==$(n).text()&&(t+=$(n).text())}),t)return $("#popUpModal").find(".modal-body").empty().text("please finish user info (请完善用户资料) !"),void $("#popUpModal").modal({show:!0});var n=$("form").serializeJSON();n.mobilePhoneAreaCode=n.nationality.split(",")[1],n.areaCode=n.nationality.split(",")[1],n.langKey=n.nationality.split(",")[0],n.fileIdFront=$("#frontImageContainer").attr("imgUrl"),n.fileIdBack=$("#backImageContainer").attr("imgUrl"),n.fileInHand=$("#holdImageContainer").attr("imgUrl"),$.ajax({method:"post",url:KYC_SUBMIT_URL,headers:{Authorization:"Bearer "+getToken()},data:JSON.stringify(n),contentType:"application/json"}).done(function(e,t,n){if(e.success){var a="The information you submitted has been uploaded successfully, waiting for the staff to review.(您提交的信息已上传成功，等待工作人员审核中) ";$("#popUpModal").find(".modal-body").empty().text(a),$("#popUpModal").modal({show:!0});var i=$(".page-title").text();$(".page-title").html(i+'<span style="color: #4393d8; display: block;">The information you submitted has been uploaded successfully, waiting for the staff to review.(您提交的信息已上传成功，等待工作人员审核中) </span>'),$(".btn-submit").attr("disabled","disabled"),setTimeout(function(){location.href=IIC_KYC_STATUS_PAGE},3e3)}else $("#popUpModal").find(".modal-body").empty().text(e.message),$("#popUpModal").modal({show:!0})})})}function getKycStatus(){$.ajax({context:this,method:"get",url:KYC_STATUS_URL,headers:{Authorization:"Bearer "+getToken()},contentType:!1,processData:!1,data:JSON.stringify({}),success:function(e,t,n){if(e.success){var a=e.data;if(!a)return;if(a.idName&&$("input[name=idName]").val(a.idName),a.idNum&&$("input[name=idNum]").val(a.idNum),a.phoneNum&&$("input[name=phoneNum]").val(a.phoneNum),a.nationality&&$("select[name=nationality]").val(a.nationality),a.fileIdFront&&($("#frontImageContainer").attr("isupload","1"),$("#frontImageContainer").find(".upload-image").css({"background-image":"url("+a.fileIdFront+")"})),a.fileIdBack&&($("#backImageContainer").attr("isupload","1"),$("#backImageContainer").find(".upload-image").css({"background-image":"url("+a.fileIdBack+")"})),a.fileInHand&&($("#holdImageContainer").attr("isupload","1"),$("#holdImageContainer").find(".upload-image").css({"background-image":"url("+a.fileInHand+")"})),a.ethAddress&&$("input[name=ethAddress]").val(a.ethAddress),e.data)if(1===e.data.kycStatus){$("input").attr("disabled","disabled"),$(".btn-submit").attr("disabled","disabled");var i=$(".page-title").text(),r='<span style="color: #4393d8; display: block;">您提交的信息已上传成功，等待工作人员审核中 (The information you submitted has been uploaded successfully, waiting for the staff to review. )</span>';$(".page-title").html(i+""+r)}else if(0===e.data.kycStatus){var i=$(".page-title").text(),r='<span style="color: #4393d8; display: block;"> 审核中(Processing...) </span>';$(".page-title").html(i+" "+r)}else if(2===e.data.kycStatus){var i=$(".page-title").text(),r='<span style="color: #4393d8; display: block;"> 审核失败(The ID Card name fail to match your name...) </span>';$(".page-title").html(i+" "+r)}else if(3===e.data.kycStatus){var i=$(".page-title").text(),r='<span style="color: #4393d8; display: block;"> 审核失败(Authentication fail...) </span>';$(".page-title").html(i+" "+r)}}},error:function(e,t,n){}})}var isAddress=function(e){return e=e.toLowerCase(),!!/^(0x)?[0-9a-f]{40}$/i.test(e)&&(!(!/^(0x)?[0-9a-f]{40}$/.test(e)&&!/^(0x)?[0-9A-F]{40}$/.test(e))||void 0)},isChecksumAddress=function(e){e=e.replace("0x","");for(var t=sha3(e.toLowerCase()),n=0;n<40;n++)if(parseInt(t[n],16)>7&&e[n].toUpperCase()!==e[n]||parseInt(t[n],16)<=7&&e[n].toLowerCase()!==e[n])return!1;return!0};$(document).ready(function(){getKycStatus(),bindEvent(),$.i18n({locale:"en"}).load({en:"/i18n/en.json",zh:"/i18n/zh.json"}).then(function(){switchLang4Kyc(2)})});