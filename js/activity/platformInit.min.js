function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();define("platformInit/utils/appsUtils",["lodash","experiment"],function(e,t){"use strict";function r(t,r,n){if(t){var i,o,a=(i=t,o=n,e(o).map(function(e){return i.getDynamicPageData(e)}).find());if(a){var s=a.routerData,u=a.routerDefinition;if(s&&u)if("wix-code"===u.appDefinitionId)e.forEach(n,function(t){e.forEach(r,function(e){e.id===t&&(e.routerData=s)})});else{var d=e.find(r,{id:u.appDefinitionId});d&&(d.routerData=s)}}}}function n(t){return e(t).reject({displayName:"siteextension"}).map(function(t){return e.assign({type:w.APPLICATION},t)}).value()}function i(t){return!!e.get(t,["wixCodeModel","appData","codeAppId"])}function o(t,o,a){t=e.without(t,"masterPage");var s=n(a);return function(t,r,n,o,a){if(i(o.rendererModel)&&e.find(t,r)){var s=o.isPlatformAppOnPage("masterPage","wixCode");e.forEach(n,function(t){var r=o.isPlatformAppOnPage(t,"wixCode"),n=o.getDataByQuery(t),i=e.get(n,"isPopup");r&&a.push({id:t,type:i?w.POPUP:w.PAGE,displayName:o.getPageTitle(t)}),!i&&s&&a.push({id:t,type:w.MASTER_PAGE})})}}(a,{displayName:"siteextension"},t,o,s),r(o,s,t),s}function a(){for(var e=arguments[0],t=1;t<arguments.length;++t)e=e.replace(/\/$/,"")+"/"+arguments[t].replace(/^\//,"");return e}function s(t,r,n,o){if(i(o)&&e.find(t,{type:"siteextension"})&&!e.find(t,{appDefinitionId:"dataBinding"})){var s=function(e,t,r){var n=a(e.scriptsDomainUrl,"services",t);return r?a(n,r):e.scriptsLocationMap[t]}(r,"dbsm-viewer-app",n.dataBinding);return e.assign({},t,{fakeApplicationId:{appDefinitionId:"dataBinding",appFields:{platform:{viewerScriptUrl:a(s,"/app.js"),viewerVerboseScriptUrl:a(s,"/app.verbose.js")}},type:w.APPLICATION}})}return t}function u(r,n){return e(r).filter(function(r){return!(r.appDefinitionId===g&&!t.isOpen("sv_ecomViewerScriptUrl",{rendererModel:n}))&&(r.appDefinitionId===m?i(n):(o=r,e.has(o,"appFields.platform.viewerScriptUrl")));var o}).map(function(r){var i=e.pickBy({id:r.appDefinitionId,displayName:r.type,appInnerId:r.applicationId,instance:r.instance}),o=function(r,n){var i=e.get(r,"appFields.platform.viewerScriptUrl"),o=e.get(r,"appFields.platform.viewerVerboseScriptUrl");return t.isOpen("wixCodeVerboseMode")&&n&&o?o:i}(r,n.previewMode);return o&&(i.url=o),i}).value()}function d(t){var r,n=(r=t.viewerPlatformAppSources,e(r||"").split(",").invokeMap("split",/:(.+)/).fromPairs().value()),i=u(s(t.clientSpecMap,t.serviceTopology,n,t.rendererModel),t.rendererModel);return function(t,r,n){if(e.get(t,"port")&&e.get(t,"path")&&e.get(t,"id")){n=e.endsWith(n,"/")?n.slice(0,-1):n;var i=e.template("<%= santaBase %><%= port %>/<%= path %>"),o=void 0;o=/^(http(s)?:)?\/\//.test(t.path)?t.path:i("80"===t.port?{santaBase:n,port:"",path:t.path}:{santaBase:n,port:":"+t.port,path:t.path}),r.push({type:w.APPLICATION,id:t.id,url:o,displayName:t.id})}}(n,i,t.santaBase),i}function p(t,r,n){return o(r,n,d({clientSpecMap:t,viewerPlatformAppSources:e.get(n,["currentUrl","query","viewerPlatformAppSources"]),serviceTopology:n.serviceTopology,santaBase:n.santaBase,rendererModel:n.rendererModel}))}function c(r,n,i){return"platform.components.AppController"===r.componentType||function(r,n,i){if(!l(r.componentType))return!1;var o=r.dataQuery.replace("#",""),a=n.getDataByQuery(o,i.id),s=n.getClientSpecMapEntry(a.applicationId);return!(e.get(s,"appDefinitionId")===g&&!t.isOpen("sv_ecomViewerScriptUrl",n))&&e.get(s,"appFields.platform.viewerScriptUrl")}(r,n,i)}function l(e){return["wysiwyg.viewer.components.tpapps.TPAMultiSection","wysiwyg.viewer.components.tpapps.TPASection","wysiwyg.viewer.components.tpapps.TPAGluedWidget","wysiwyg.viewer.components.tpapps.TPAWidget"].includes(e)}function f(t,r){var n,i,o=e.filter(t,"json"),a=(n=e.map(o,"json"),i=r,e(n).transform(function(t,r){e.assign(t,e.get(r,"data.connections_data"))},{}).values().flatMap(function(t){var r=i.resolveData(t,null,i.dataTypes.CONNECTIONS);return e.get(r,"items")}).groupBy("controllerId").value());return e.flatMap(o,function(t){var n=e.filter(e.get(t,"json.structure.DESKTOP"),function(e){return c(e,r,t)});return e.map(n,function(n){var i=n.dataQuery.replace("#",""),o=r.getDataByQuery(i,t.id);return l(n.componentType)&&(o.controllerType=function(t,r){var n=r.getClientSpecMapEntry(t.applicationId);return n?t.widgetId||e.findKey(n.widgets,["appPage.hidden",!1]):null}(o,r),o.settings={compId:n.id}),e.omitBy({controllerBehaviors:e.get(r.getDataByQuery(n.behaviorQuery,t.id,r.dataTypes.BEHAVIORS),"items",[]),controllerData:o,controllerId:i,compId:n.id,connections:e.get(a,i),dependencies:function(t,r,n){var i=n.getDataByQuery(t.connectionQuery,r.id,n.dataTypes.CONNECTIONS);return i?e(i.items).filter({type:"ConnectionItem"}).map("controllerId").value():[]}(n,t,r)},e.isUndefined)})})}var g="1380b703-ce81-ff05-f115-39571d94dfcd",m="675bbcef-18d8-41f5-800e-131ec9e08762",w={POPUP:"Popup",PAGE:"Page",MASTER_PAGE:"masterPage",APPLICATION:"Application"};return{getApplications:p,getUserCodeDefinitions:function(t,r,n){return e.reject(p(t,r,n),{type:w.APPLICATION})},getAppsBaseInfo:function(t){var r=d(t);return e.filter(n(r),"url")},getContextInitData:function(t,r){var n=f(function(t,r){var n=[{id:t,json:r.getPageData(t)}];if(e.get(r.getDataByQuery(t),"isPopup"))return n;var i=r.MASTER_PAGE_ID;return n.concat({id:i,json:r.getMasterPageData()})}(r,t),t);return e.mapValues(e(n).groupBy("controllerData.applicationId").mapValues(function(t){return e(t).keyBy("controllerId").mapValues(function(t){return e.pick(t,["controllerData","controllerBehaviors","connections","compId","dependencies"])}).value()}).value(),function(e){return{controllers:e}})}}}),define("platformInit/utils/widgetsPreLoader",["platformInit/utils/appsUtils"],function(e){"use strict";function t(e,t,u,d){if(n())return s.push([e,t,u,d]),void requirejs(["utils","widgets","wixCode"],r);var p=d(i);p.currentUrl=i.urlUtils.parseUrl(e);var c=i.wixUrlParser.parseUrl(p,e),l=c&&c.pageId;if(l){var f=t(o,p,l),g=a.wixCodeWidgetService.getWixCodeSpec(p.getClientSpecMap());u(a.messageBuilder.getExtendedMessage(f,p.rendererModel.wixCodeModel||{},g,p))}}function r(e,r,u){n()&&(i=e,o=r,a=u,s.forEach(function(e){return t.apply(void 0,_toConsumableArray(e))}),s.length=0)}function n(){return!i||!o||!a}var i=null,o=null,a=null,s=[];return{asyncGetPreLoadMessage:function(r,n,i){t(n,function(t,n,i){var o=e.getApplications(r.rendererModel.clientSpecMap,[i],n),a=r.routers||{configMap:{}},s=t.modelBuilderDataHelper.getApi(n),u=t.globalsBuilder.build(s,!0,i);return t.messageBuilder.loadWidgetsMessage(o,a.configMap,[i],void 0,_defineProperty({},i,u.toJson()))},i,function(e){return new e.FullSiteData(r,function(){})})},asyncGetPreLoadUserCodeMessage:function(r,n,i){t(n,function(t,n,i){var o=e.getUserCodeDefinitions(r.rendererModel.clientSpecMap,[i],n);return t.messageBuilder.loadUserCodesMessage(o,[i])},i,function(e){return new e.FullSiteData(r,function(){})})},asyncGetPreInitMessage:function(r,n,i){t(n,function(t,r,n){var i={};return i[n]=e.getContextInitData(r,n),t.messageBuilder.initWidgetsMessage(i)},i,function(){return r})},registerDeps:r}}),define("platformInit/utils/constants",[],function(){"use strict";return{APPS:{SANTA_MEMBERS:{appDefId:"14cc59bc-f0b7-15b8-e1c7-89ce41d0e0c9"},FORM_BUILDER:{appDefId:"14ce1214-b278-a7e4-1373-00cebd1bef7c"}},WIX_CODE_NAMESPACES_AND_ELEMENTORY_SUPPORT_PATH:"/wixCodeNamespacesAndElementorySupport.min.js",DATA_BINDING:"dataBinding",REMOTE_DOM_URL:"//unpkg.parastorage.com/@shimil/remote-dom@3.0.3/dist/remote.min.js",SEMI_NATIVE_SDK_URL:"http://static.parastorage.com/services/semi-native-sdk/1.3.0/lib/wix.min.js",PM_RPC_INTENTS:{INVOKE:"invoke",RPC_RESOLVE:"rpc-resolve",RPC_REJECT:"rpc-reject",API_DESCRIPTION:"api-desc",INVOKE_FUNCTION:"invoke-func",RESOLVE:"resolve",REJECT:"reject",REQUEST_API:"request-api"}}}),define("platformInit/utils/cookieUtils",[],function(){"use strict";return{getCookie:function(e){if("undefined"!=typeof document)return function(e){for(var t={},r=e.split(/;\s*/),n=0,i=r.length;n<i;n++){var o=r[n].split("=");t[o[0]]=o[1]}return t}(window.document.cookie)[e]}}}),define("platformInit/utils/wixCodeUrlUtils",["lodash","platformInit/utils/cookieUtils"],function(e,t){"use strict";function r(e){var t=e.appConfig.userScript;return{id:e.id,url:t.url,scriptName:t.scriptName,displayName:t.displayName,routerData:e.routerData}}return{getUserCodeUrlsDetails:function(t,n){var i=[],o=e.find(t,function(e){return e.id===n&&"masterPage"!==e.type}),a=e.find(t,{id:n,type:"masterPage"});return a&&i.push(r(a)),o&&i.push(r(o)),i},getElementoryArguments:function(r,n,i,o){var a,s=(a=i,e(a).map("appConfig").find());if(s)return{baseUrl:(u=r,d=n,u.publicModel?e.trimEnd(u.publicModel.externalBaseUrl,"/")+"/_api/wix-code-public-dispatcher/siteview":"//"+e.find(d,{type:"siteextension"}).instanceId+".dev."+u.serviceTopology.wixCloudBaseDomain),queryParameters:(p={scari:s.scari,instance:s.instance,viewMode:o},e.reduce(p,function(t,r,n){return e.isUndefined(r)?t:t.concat([n+"="+r])},[]).join("&")),options:{headers:{"X-XSRF-TOKEN":t.getCookie("XSRF-TOKEN")}}};var u,d,p}}}),define("platformInit/utils/urlBuilder",["lodash"],function(e){"use strict";function t(e){return e&&e.replace(/^https?\:/,"")}function r(r,n){var i=t(r);if(e.startsWith(i,n)){var o=i.slice(n.length).match(/\/?services\/santa\/([\w.]+)/);return o&&o[1]}}return{buildUrl:function(e,n){var i=n.runtimeSource,o=e.serviceTopology,a=function(e,n,i,o){if(e)return e;var a=t(o);return r(n,a)||r(i,a)}(i,e.santaBase,o.scriptsLocationMap.santa,o.scriptsDomainUrl),s="/node_modules/santa-wix-code/dist/wixcode-worker.js";return u=o.scriptsLocationMap.santa,/^https?:\/\/localhost(:[0-9]+)?\/?$/.test(u)?s:"/_partials/santa/"+a+s;var u}}}),define("platformInit/utils/FallbackStorage",[],function(){"use strict";return function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"setItem",value:function(e,t){this[e]=String(t)}},{key:"getItem",value:function(e){return this[e]||null}},{key:"removeItem",value:function(e){delete this[e]}},{key:"clear",value:function(){var e=this;Object.keys(this).forEach(function(t){return e.removeItem(t)})}},{key:"toJSON",value:function(){return this.storage.toJSON()}}]),e}()}),define("platformInit/utils/storageFacade",["lodash","platformInit/utils/FallbackStorage"],function(e,t){"use strict";function r(t){return e(t).pickBy(function(t,r){return e.startsWith(r,n)}).reduce(function(t,r,i){return e.assign(t,_defineProperty({},i.replace(n,""),r))},{})}var n="platform_app_";return{get:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0]?window:{localStorage:new t,sessionStorage:new t};return{serialize:function(){return JSON.stringify({local:r(e.localStorage),session:r(e.sessionStorage)})},setItem:function(t,r,i){e[t].setItem(n+r,i)}}}}}),define("platformInit/utils/messageBuilder",[],function(){"use strict";return{bootstrapMessage:function(e,t){return{type:"wix_code_worker_bootstrap",bootstrapArguments:e,fetchScriptsCount:t}},loadUserCodeMessage:function(e,t){return{type:"wix_code_worker_load_user_code",workerId:e,wixCode:t}},loadMessage:function(e,t,r,n,i,o,a,s,u){return{type:"wix_code_worker_load",workerId:e,elementoryArguments:t,wixCode:r,applications:n,sdkParameters:i,routersMap:o,lightboxContext:a,storage:s,rgi:u}},initMessage:function(e,t){return{type:"wix_code_worker_init",id:e,apps:t}},startMessage:function(e,t,r){return{type:"wix_code_worker_start",context:e,id:t,siteInfo:r}},storageWasUpdatedMessage:function(e){return{type:"storageWasUpdated",storageValue:e}},updateWixCodeModelDataAfterLoginMessage:function(e,t){return{type:"update_wix_code_model_data_after_login",workerId:e,elementoryArguments:t}},scriptImportMessage:function(e,t){return{type:"script_import_message",url:e,script:t}},stopMessage:function(e){return{contextId:e,type:"stop"}},isStopMessage:function(e){return"stop"===e.type}}}),define("platformInit/api/workerManager",["lodash","platformInit/utils/constants","platformInit/utils/wixCodeUrlUtils","platformInit/utils/urlBuilder","platformInit/utils/storageFacade","platformInit/utils/messageBuilder"],function(e,t,r,n,i,o){"use strict";function a(e){return e.publicModel?"site":"preview"}function s(){var t="undefined"!=typeof window&&!window.clientSideRender,r="undefined"==typeof window||window.isPseudoWindow;return{viewMode:a(this._siteModel),openExperiments:(n=this._siteModel.rendererModel.runningExperiments,e.reduce(n,function(e,t,r){return"new"===t&&e.push(r),e},[])),locale:this._siteModel.rendererModel.languageCode,storage:this._storageManager.serialize(),userWarmup:this._siteModel.userWarmup,renderCycle:t&&!r?2:1,renderingEnv:r?"backend":"browser"};var n}function u(t,r,n){var i=0;"undefined"!=typeof window&&(n=n&&window.fetch&&(a=window,!(a.navigator&&/Edge|Trident/.test(a.navigator.userAgent))),e.forEach(t,function(t){if(n&&e.includes(t.url,"parastorage"))++i,window.fetch(t.url).then(function(e){return e.arrayBuffer()}).then(function(e){r.postMessage(o.scriptImportMessage(t.url,e),[e])});else{var a="prefetch-"+t.id;if(!window.document.getElementById(a)){var s=window.document.createElement("link");s.setAttribute("rel","prefetch"),s.setAttribute("href",t.url),s.setAttribute("id",a),window.document.head.appendChild(s)}}}));var a;return i}function d(r){if(!this._standbyWorker){var i=new window.Worker(n.buildUrl(this._siteModel,this._options));i.addEventListener("message",this.onmessage),this._standbyWorker=i,function(r){var n=this._options.applications,i={id:"wixCodeNamespacesAndElementorySupport",url:this._siteModel.serviceTopology.scriptsLocationMap["wix-code-platform"]+t.WIX_CODE_NAMESPACES_AND_ELEMENTORY_SUPPORT_PATH},a={id:"sdk",url:this._options.sdkSource},d={id:"namespaces-sdk",url:this._options.namespacesSdkSource},p=u(function(r,n,i){var o=e.clone(r);return n.some(function(e){return e.id===t.DATA_BINDING})&&(o=o.concat(i)),o.concat(n)}([a,d],n,i),this._standbyWorker,r);this._standbyWorker.postMessage(o.bootstrapMessage({sdkParameters:s.call(this),debug:window.__WIX_CODE_DEBUG__,santaVersion:this._siteModel.baseVersion,wixCodeBase:this._siteModel.santaBase+"/node_modules/santa-wix-code",sdkSource:a.url,namespacesSdkSource:d.url,applications:JSON.stringify(n),wixCodeNamespacesAndElementorySupportScript:i,initialTimestamp:this._siteModel.wixBiSession.initialTimestamp,metaSiteId:this._siteModel.rendererModel.metaSiteId},p))}.call(this,!!r)}}function p(e){this._workers[e]=this._standbyWorker,this._reportWorkerCreated(e),this._standbyWorker=null}function c(t,n){return t.reduce(function(t,i){return e.assign(t,_defineProperty({},i,r.getUserCodeUrlsDetails(n,i)))},{})}function l(t){var r=this;return function(n){var i=n.data;e.isMatch(i,{intent:"BROWSER_API",type:"setToStorage"})&&function(t){var r=this,n=t.type,i=t.key,a=t.value;this._storageManager.setItem(n,i,a);var s=o.storageWasUpdatedMessage(this._storageManager.serialize());e.forEach(this._workers,function(e,t){r.send(t,s)})}.call(r,i.data),t(n)}}var f=function(){function n(e,t,r,i){_classCallCheck(this,n),this._siteModel=e,this._clientSpecMap=t,this._options=i,this._workers={},this._terminatedWorkers={},this._standbyWorker=null,this._storageManager=r}return _createClass(n,[{key:"has",value:function(e){return Boolean(this._workers[e])}},{key:"initialize",value:function(r,n,i,o){this.onmessage=function(r){return function(n){var i=n.data,o=n.ports;e.includes(t.PM_RPC_INTENTS,i.intent)&&window.postMessage(i,"*",o),r(n)}}.call(this,l.call(this,function(e){var t=e.data;return r(t)})),this._reportWorkerCreated=n,this._reportWorkerTerminated=i,d.call(this,o)}},{key:"send",value:function(e,t,r){var n=o.isStopMessage(t)?this._terminatedWorkers[e]:this._workers[e];n&&(r?n.postMessage(t,r):n.postMessage(t))}},{key:"get",value:function(e){return this._workers[e]}},{key:"handleWidgetsCommand",value:function(t,n){var i=this;switch(t.type){case"load_user_code":(function(e){var t=this;Object.keys(e).forEach(function(r){var n=e[r];u(n),t.has(r)||(d.call(t),p.call(t,r)),t.send(r,o.loadUserCodeMessage(r,n))})}).call(this,c(t.rootIds,t.widgets));break;case"load_widgets":(function(e){var t=this,r=e.applications,n=e.rootIds,i=e.wixCodeScriptsByRootId,a=e.elementoryArguments,s=e.popupContexts,u=e.routersMap,c=e.sdkParameters,l=e.rgisByRootId;n.forEach(function(e){t.has(e)||(d.call(t),p.call(t,e)),t.send(e,o.loadMessage(e,a,i[e],r,c,u,s[e],t._storageManager.serialize(),l[e]))})}).call(this,{applications:e.reject(t.widgets,e.overSome({type:"Page"},{type:"Popup"},{type:"masterPage"})),rootIds:t.rootIds,wixCodeScriptsByRootId:c(t.rootIds,t.widgets),elementoryArguments:r.getElementoryArguments(this._siteModel,this._clientSpecMap,t.widgets,a(this._siteModel)),popupContexts:t.popupContexts,routersMap:t.routersMap,sdkParameters:t.sdkParameters,rgisByRootId:t.rgisByRootId});break;case"init_widgets":e.forEach(t.contexts,function(e,t){if(!i.has(t))throw new Error("Context id "+t+" is not loaded");i.send(t,o.initMessage(t,e))});break;case"start_widgets":if(!t.contexts)throw new Error("Start message must contain contexts property");e.forEach(t.contexts,function(e,r){if(!i.has(r))throw new Error("Context id "+r+" is not loaded");i.send(r,o.startMessage(e,r,t.siteInfo))});break;case"trigger_onRender":d.call(this),this.send(t.contextId,t);break;case"stop_widgets":e.forEach(t.widgetIds,function(t){(function(t){var r=this,n=this._workers[t];return!!n&&(delete this._workers[t],this._terminatedWorkers[t]=n,e.defer(function(){r.send(t,o.stopMessage(t)),delete r._terminatedWorkers[t]}),!0)}).call(i,t)&&i._reportWorkerTerminated(t)});break;case"update_wix_code_model_data_after_login":e.forEach(t.rootIds,function(e){i.send(e,o.updateWixCodeModelDataAfterLoginMessage(e,r.getElementoryArguments(i._siteModel,i._clientSpecMap,t.widgets,a(i._siteModel))))});break;default:this.has(t.contextId)&&this.send(t.contextId,t,n)}}},{key:"terminateStandbyWorker",value:function(){this._standbyWorker&&(this._standbyWorker.terminate(),this._standbyWorker=null)}}]),n}();return{getWorkerManager:function(e,t,r,n){return new f(e,t,i.get(r),n)}}}),define("platformInit/utils/messageProxy",[],function(){"use strict";return{get:function(){var e=[],t=null;return{sendOrHoldMessage:function(r,n){t?t(r,n):e.push({message:r,ports:n})},setMessageHandler:function(r){for(t=r;e.length>0;){var n=e.shift();t(n.message,n.ports)}}}}}}),define("platformInit/utils/biUtils",["lodash"],function(e){"use strict";return{reportBiWithWixBiSession:function(e){var t=e.reportDef,r=e.params;"undefined"!=typeof window&&(t.errorCode?window.wixBiSession.sendError(t,r.p1,r.p2,r.p3,r.p4):window.wixBiSession.sendBI(t.endpoint,t.eventId,t.src,r))},shouldUseFallbackReportBI:function(t,r){return"WIX_CODE_SITE_API"===t.intent&&"reportBI"===t.type&&e.isEmpty(r)&&"undefined"!=typeof window}}}),define("platformInit/bi/events.json",[],function(){return{WORKER_CREATED:{endpoint:"platform-viewer",src:79,eventId:101,params:{worker_id:"worker_id",ts:"ts"}},WORKER_TERMINATED:{endpoint:"platform-viewer",src:79,eventId:102,params:{worker_id:"worker_id",ts:"ts"}}}}),define("platformInit/api/wixCodeAppApi",["lodash","platformInit/utils/widgetsPreLoader","platformInit/api/workerManager","platformInit/utils/messageProxy","platformInit/utils/biUtils","platformInit/bi/events.json"],function(e,t,r,n,i,o){"use strict";function a(t){var r=t.rendererModel.clientSpecMap.toJS?t.rendererModel.clientSpecMap.toJS():t.rendererModel.clientSpecMap;return t.rendererModel.wixCodeModel&&e.some(r,{type:"siteextension"})}return{getApi:function(){function s(e){i.shouldUseFallbackReportBI(e,d)&&i.reportBiWithWixBiSession(e),d.forEach(function(t){t(e)})}var u=n.get(),d=[],p=[],c=!1,l=!1,f=!1,g=!1,m=void 0,w=void 0;return{init:function(t,n,d,p){e.isUndefined(d.applications)&&(d.applications=[]),c?console.warn("Wix code is already initiated"):(w=d.applications.length>0,(a(t)||w)&&((m=r.getWorkerManager(t,n,function(){try{return window.localStorage.setItem("",""),window.localStorage.removeItem(""),!0}catch(e){return!1}}(),d)).initialize(s,function(e){return i.reportBiWithWixBiSession({reportDef:o.WORKER_CREATED,params:{worker_id:e,ts:Date.now()-t.wixBiSession.initialTimestamp}})},function(e){return i.reportBiWithWixBiSession({reportDef:o.WORKER_TERMINATED,params:{worker_id:e,ts:Date.now()-t.wixBiSession.initialTimestamp}})},p),u.setMessageHandler(function(e,t){return m.handleWidgetsCommand(e,t)}),c=!0))},sendMessage:function(e,t){e&&u.sendOrHoldMessage((r=e,p.reduce(function(e,t){return t(e)},r)),t);var r},registerMessageHandler:function(e){d.push(e)},registerMessageModifier:function(e){p.push(e)},unregisterMessageHandler:function(t){e.pull(d,t)},preLoadWidgets:function(e,r){!l&&a(e)&&t.asyncGetPreLoadMessage(e,r,function(e){l||(l=!0,u.sendOrHoldMessage(e))})},preLoadUserCode:function(e,r){(!f&&a(e)||w)&&t.asyncGetPreLoadUserCodeMessage(e,r,function(e){f||(f=!0,u.sendOrHoldMessage(e))})},preInitWidgets:function(e,r){!g&&a(e)&&t.asyncGetPreInitMessage(e,r,function(e){g||(g=!0,u.sendOrHoldMessage(e))})},isAppInitiated:function(){return c},getWorkerById:function(e){return m&&m.get(e)},destroyAppsContainer:function(){m&&(m.terminateStandbyWorker(),c=!1,u=n.get())}}}}}),define("platformInit/api/initMainR",["lodash","platformInit/utils/appsUtils"],function(e,t){"use strict";return function(r){var n=r.appApi,i=r.siteModel,o=r.isMobileView,a=r.queryUtil,s=r.currentUrl,u=r.isBot,d=r.fetchScripts;s=s||e.get(i,"currentUrl.full",window.document.location.href);var p,c=e.trimEnd(i.serviceTopology.scriptsLocationMap["js-wixcode-sdk"],"/")+"/lib/"+(a.getParameterByName("debug")?"wix.js":"wix.min.js"),l=e.trimEnd(i.serviceTopology.scriptsLocationMap["wixcode-namespaces"],"/")+"/"+(a.getParameterByName("debug")?"wixcode-namespaces.js":"wixcode-namespaces.min.js"),f="false"!==(p=a.getParameterByName("useWixCodeFallback"))&&("true"===p||!window.Worker||u),g={isMobileView:o,sdkSource:c,namespacesSdkSource:l,runtimeSource:a.getParameterByName("WixCodeRuntimeSource"),useWixCodeFallback:f},m=a.getParameterByName("viewerPlatformAppSources");g.applications=t.getAppsBaseInfo({rendererModel:i.rendererModel,clientSpecMap:i.rendererModel.clientSpecMap,serviceTopology:i.serviceTopology,viewerPlatformAppSources:m,santaBase:i.santaBase}),function(t){n.init(i,t,g,d),r=t,(e.some(r,{type:"siteextension"})||g.applications.length)&&(n.preLoadUserCode(i,s),i.publicModel&&n.preLoadWidgets(i,s));var r}(i.rendererModel.clientSpecMap)}}),define("platformInit/utils/specMapUtils",["lodash"],function(e){"use strict";return{getAppSpec:function(t,r){return e.find(t,{appDefinitionId:r})||e.find(t,{type:"siteextension"})}}}),define("platformInit",["platformInit/api/wixCodeAppApi","platformInit/api/initMainR","platformInit/utils/specMapUtils","platformInit/utils/appsUtils","platformInit/utils/widgetsPreLoader","platformInit/utils/messageProxy","platformInit/utils/biUtils"],function(e,t,r,n,i,o,a){"use strict";return{getAppApi:e.getApi,initMainR:t,specMapUtils:r,appsUtils:n,biUtils:a,widgetsPreLoader:i,registerDeps:i.registerDeps,messageProxy:o}});