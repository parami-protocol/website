define(["lodash","coreUtilsLib"],function(n,t){return function(n){function t(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return n[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var e={};return t.m=n,t.c=e,t.d=function(n,e,r){t.o(n,e)||Object.defineProperty(n,e,{configurable:!1,enumerable:!0,get:r})},t.r=function(n){Object.defineProperty(n,"__esModule",{value:!0})},t.n=function(n){var e=n&&n.__esModule?function(){return n.default}:function(){return n};return t.d(e,"a",e),e},t.o=function(n,t){return Object.prototype.hasOwnProperty.call(n,t)},t.p="",t(t.s=6)}([function(t,e){t.exports=n},function(n,t,e){"use strict";function r(n){return w.get(n,["conversionData","desktopOnly"],!1)}function o(n){return"text"===w.get(n,["conversionData","category"])}function i(n){return"graphic"===w.get(n,["conversionData","category"])||a(n)}function u(n){return n&&"wysiwyg.viewer.components.Group"===n.componentType}function c(n){return"columns"===w.get(n,["conversionData","category"])}function a(n){return"photo"===w.get(n,["conversionData","category"])}function s(n){return"masterPage"===w.get(n,"id")}function f(n){var t=function(n){return w.get(n.conversionData,"isScreenWidth",!1)||w.get(n.conversionData,"stretchHorizontally",!1)||w.some(n.components,t)};return T(n)||t(n)}function l(n){return w.get(n.conversionData,"isScreenWidth",!1)||w.some(n.components,l)}function p(n,t,e){void 0===t&&(t=0),void 0===e&&(e=0),w.forEach(n,function(n){n.layout.x+=t,n.layout.y+=e})}function m(n,t,e){d(n,[t],e),p([t],-n.layout.x,-n.layout.y)}function d(n,t,e){var r=M(n);t.length&&r&&(e=void 0!==e?e:r.length,r.splice.apply(r,[e,0].concat(t)))}function v(n,t){var e=M(n);w.remove(e,function(n){return w.includes(t,n)})}function y(n,t){if(u(n)){var e=w.findIndex(t.components,{id:n.id});w.forEach(n.components.reverse(),function(r){d(t,[r],e),p([r],n.layout.x,n.layout.y)}),w.remove(t.components,n)}}function g(n,t){return w.some(M(n),function(n){return t(n)||n&&g(n,t)})}function E(n,t,e){if(!s(n)&&t&&(e||!w.isEmpty(t))){var r=w(t).reject(["conversionData.isInvisible",!0]).reduce(function(n,t){return w.max([n,t.layout.y+t.layout.height,0])},0);return w.get(n,["conversionData","hasTightYMargin"])||w.get(n,["conversionData","hasTightBottomMargin"])?r:r+(f(n)?U.a.SECTION_MOBILE_MARGIN_Y:U.a.COMPONENT_MOBILE_MARGIN_Y+w.get(n.conversionData,"borderWidth",0))}}function h(n,t,e,r){void 0===r&&(r=0);var o=E(n,t,e);if(w.isNumber(o)){var i=w.get(n,["conversionData","minHeight"],r);n.layout.height=Math.max(i,o)}}function T(n){return _(n)||D(n)}function _(n){return"Page"===n.type}function R(n){return"Container"===n.type}function D(n){return w.has(n.conversionData,"siteSegmentRole")}function N(n){var t=F.objectUtils.cloneDeep(n),e=w.has(t,"components")?"components":"children";return w.set(t,e,n.mobileComponents||[])}function x(n,t){if(t.id===n)return t;var e=null;return w.find(M(t),function(t){return e=x(n,t)}),e}function I(n,t){if(n.length>t)n.length=0;else for(var e=n.length-1;e>=0;e--)!function(t){var e=w.findLastIndex(n,function(e,r){return r<t&&(o=n[t],i=e,w.size(w.intersection(o,i))>0);var o,i});-1!==e&&(n[e]=n[e].concat(w.difference(n[t],n[e])),n.splice(t,1))}(e)}function O(n,t){var e=M(n);return w.map(t,function(n){return w.find(e,{id:n})||null})}function C(n,t){var e=M(t);if(w.find(e,{id:n}))return t;var r=null;return w.find(e,function(t){return r=C(n,t)}),r}function P(n){if(n&&0!==n.length){var t=w.min(w.map(n,"layout.x")),e=w.min(w.map(n,"layout.y"));return{x:t,y:e,width:w.max(w.map(n,function(n){return n.layout.x+n.layout.width}))-t,height:w.max(w.map(n,function(n){return n.layout.y+n.layout.height}))-e,rotationInDegrees:0}}}function S(){return{x:U.a.MOBILE_WIDTH-(U.a.TINY_MENU_SIZE+U.a.SITE_SEGMENT_PADDING_X),y:U.a.SECTION_MOBILE_MARGIN_Y,rotationInDegrees:0}}function M(n){return n.components||n.children}function b(n,t){void 0===n&&(n=[]),void 0===t&&(t=[]);var e=function(n,t){return Math.min(n[1],t[1])-t[0]};return n[0]<=t[0]?e(n,t):e(t,n)}function A(n,t){var e=function(n){return[n.layout.y,n.layout.height+n.layout.y]};return b(e(n),e(t))}function G(n,t){if(l(n))return t.layout.width;if(l(t))return n.layout.width;var e=function(n){return[n.layout.x,n.layout.width+n.layout.x]};return b(e(n),e(t))}function L(n,t){return l(n)?n.layout.height>=t.layout.height||X(n)>X(t):!l(t)&&X(n)>X(t)}function V(n,t,e){var r=G(n,t),o=A(n,t);if(r<=0||o<=0)return!1;var i=r*o,u=Math.min(X(n),X(t));return i>0&&i/u>=e}function z(n){return!!R(n)&&("columns"===n.conversionData.category?1===w.size(n.components)&&w.isEmpty(n.components[0].components):w.isEmpty(n.components))}function B(n,t){return c(t)&&w.get(n,["conversionData","isInvisible"],!1)}function j(n,t,e){void 0===t&&(t=!1);for(var r=[[n]],o=0,i=r;o<i.length;o++){var u=i[o];w.forEach(u,function(n){var e=t?w.get(n,"mobileComponents"):M(n);w.isEmpty(e)||r.push(e)})}return w(r).flatten().remove(e).keyBy("id").value()}e.r(t),e.d(t,"isMergeVirtualGroup",function(){return H}),e.d(t,"isRescaleVirtualGroup",function(){return Y}),e.d(t,"isVirtualGroup",function(){return W}),e.d(t,"isDesktopOnlyComponent",function(){return r}),e.d(t,"isTextComponent",function(){return o}),e.d(t,"isGraphicComponent",function(){return i}),e.d(t,"isGroupComponent",function(){return u}),e.d(t,"isColumnsContainerComponent",function(){return c}),e.d(t,"isImageComponent",function(){return a}),e.d(t,"isMasterPage",function(){return s}),e.d(t,"shouldStretchToScreenWidth",function(){return f}),e.d(t,"isScreenWidthComponent",function(){return l}),e.d(t,"translateComps",function(){return p}),e.d(t,"reparentComponent",function(){return m}),e.d(t,"addComponentsTo",function(){return d}),e.d(t,"removeChildrenFrom",function(){return v}),e.d(t,"removeGroup",function(){return y}),e.d(t,"containsComponent",function(){return g}),e.d(t,"getHeightAccordingToChildren",function(){return E}),e.d(t,"ensureContainerTightlyWrapsChildren",function(){return h}),e.d(t,"isSiteSegmentOrPage",function(){return T}),e.d(t,"isPageComponent",function(){return _}),e.d(t,"isContainerComponent",function(){return R}),e.d(t,"isSiteSegment",function(){return D}),e.d(t,"extractMobilePage",function(){return N}),e.d(t,"getComponentByIdFromStructure",function(){return x}),e.d(t,"unifyGroups",function(){return I}),e.d(t,"getComponentsByIds",function(){return O}),e.d(t,"getParent",function(){return C}),e.d(t,"getSnugLayout",function(){return P}),e.d(t,"getTinyMenuDefaultPosition",function(){return S}),e.d(t,"getChildren",function(){return M}),e.d(t,"getRangesOverlap",function(){return b}),e.d(t,"getYOverlap",function(){return A}),e.d(t,"getXOverlap",function(){return G}),e.d(t,"hasGreaterArea",function(){return L}),e.d(t,"haveSufficientOverlap",function(){return V}),e.d(t,"isEmptyContainer",function(){return z}),e.d(t,"shouldReparentCompToChildOfContainer",function(){return B}),e.d(t,"getAllCompsInStructure",function(){return j});var w=e(0),U=e(2),F=e(4),H=function(n){return w.get(n,"componentType")===U.a.VIRTUAL_GROUP_TYPES.MERGE},Y=function(n){return w.get(n,"componentType")===U.a.VIRTUAL_GROUP_TYPES.RESCALE},W=function(n){return Y(n)||H(n)},X=function(n){return n.layout.width*n.layout.height}},function(n,t,e){"use strict";e.d(t,"a",function(){return r});var r={MOBILE_WIDTH:320,MARGIN_BETWEEN_TEXT_AND_NON_TEXT:20,COMPONENT_MOBILE_MARGIN_X:10,COMPONENT_MOBILE_MARGIN_Y:10,SECTION_MOBILE_MARGIN_Y:20,SITE_SEGMENT_PADDING_X:20,TINY_MENU_SIZE:50,TEXT_MAX_LENGTH_FOR_RESCALING:25,MIN_WIDTH_FOR_ENLARGE:140,DEFAULT_TEXT_HEIGHT:10,VIRTUAL_GROUP_TYPES:{RESCALE:"RESCALE_VIRTUAL_GROUP",MERGE:"MERGE_VIRTUAL_GROUP"}}},function(n,t,e){"use strict";function r(n,t,e,r){void 0===r&&(r=l);var o=s.get(n,e),i=s.get(t,e);return Math.abs(o-i)<=r*s.min([o,i])}function o(n,t,e){return n===t||s.size(n)===s.size(t)&&!i(n,e)&&!i(t,e)&&s.every(n,function(n,o){var i=t[o];return n.componentType===i.componentType&&function(n,t,e,r){void 0===r&&(r=l);var o=s.get(n,["layout",e]),i=s.get(t,["layout",e]);return Math.abs(o-i)<=r*s.min([m(n,e),m(t,e)])}(n,i,e)&&("text"===n.conversionData.category?r(n,i,["conversionData","averageNormalizedFontSize"]):r(n,i,["layout","height"])&&r(n,i,["layout","width"]))})}function i(n,t){var e=s.findIndex(n,function(e,r){if(0===r)return!1;var o=d(n[r-1],t),i=e.layout[t]-o;return i<0||i>s.min([m(n[r-1],t),m(e,t)])});return-1!==e&&e!==n.length-1}function u(n){var t=f.getChildren(n);return s.map(n.conversionData.componentsOrder,function(n){return s.find(t,{id:n})})}function c(n,t){var e=s.map(f.getChildren(n),"id");return s.sortBy(t,function(n){return e.indexOf(n.id)})}function a(n){var t=s.pick(n.conversionData.mobileHints,["recommendedWidth","recommendedHeight","recommendedScale","recommendedOrder"]);return!s.isEmpty(t)}e.d(t,"e",function(){return p}),e.d(t,"c",function(){return m}),e.d(t,"b",function(){return d}),e.d(t,"a",function(){return o}),e.d(t,"d",function(){return u}),e.d(t,"g",function(){return v}),e.d(t,"h",function(){return c}),e.d(t,"f",function(){return a});var s=e(0),f=e(1),l=.1,p=function(n){return 0===n?0:n/Math.abs(n)},m=function(n,t){return"x"===t?n.layout.width:n.layout.height},d=function(n,t){return n.layout[t]+m(n,t)},v=function(n){return f.isRescaleVirtualGroup(n)&&"reorder"!==n.conversionData.rescaleMethod||n.conversionData.structuralContainer}},function(n,e){n.exports=t},function(n,t,e){"use strict";function r(n,t){return g.transform(n,function(n,e,r){var o=t(r);return n[o]=n[o]||{comps:[],distanceToPreviousFragment:e.distanceToPreviousFragment},n[o].comps=n[o].comps.concat(e.comps),n},[])}function o(n,t,e){return g.assign(e,{fragments:[{comps:n,distanceToPreviousFragment:-1}],fragmentsEvents:[t]})}function i(n,t){var e=g.findLastIndex(n,function(n){if(n.coordinate===t.coordinate){if(n.eventType===T.START_EVENT&&t.eventType===T.START_EVENT)return n.size>t.size;if(n.eventType===T.END_EVENT&&t.eventType===T.END_EVENT)return n.size<t.size;if(n.eventType===T.START_EVENT&&t.eventType===T.END_EVENT)return n.compRef===t.compRef;if(n.eventType===T.END_EVENT&&t.eventType===T.START_EVENT)return n.compRef!==t.compRef}return n.coordinate<t.coordinate});return n.splice(e+1,0,t),n}function u(n,t){var e=g.transform(n,function(n,e){var r=e.layout[t]||0,o=Object(E.b)(e,t)||r,u=Object(E.c)(e,t)||0;return i(n,{eventType:T.START_EVENT,compRef:e,coordinate:r,size:u}),i(n,{eventType:T.END_EVENT,compRef:e,coordinate:o,size:u}),n},[]);return g.map(e,function(n){return g.omit(n,"size")})}function c(n){var t=[],e=[];return g.forEach(n,function(n){var r=g.last(e);if(n.eventType===T.START_EVENT){if(g.isEmpty(t)){var o={events:[n],distanceToPreviousFragment:r?n.coordinate-g.last(r.events).coordinate:-1};e.push(o)}else r.events.push(n);t.push(n)}else g.remove(t,{compRef:n.compRef}),r.events.push(n)}),g.map(e,function(n){return{comps:N(n.events),distanceToPreviousFragment:n.distanceToPreviousFragment}})}function a(n,t,e){var o=g.maxBy(n,"distanceToPreviousFragment"),i=g.findIndex(n,o),u=r(n,function(n){return n<i?0:1}),c=[n[i-1],o],a=g.filter(t[x(e)],function(n){return g.some(c,function(t){return g.includes(t.comps,n.compRef)})}),f={fragmentsEvents:l(t,u),fragments:u},p=s(c,a,e);return g.assign(f,{maxCompsDistance:p})}function s(n,t,e){for(var r=function(n,t){return g(n).map(function(n,e){return e?g.map(n,function(n){return g.defaults({closestPoint:n.compRef.layout[t]},n)}):g.map(n,function(n){return g.defaults({closestPoint:Object(E.b)(n.compRef,t)},n)})}).map(function(n,t){return g.reduce(n,function(n,e){var r=g.last(n);return r&&r.eventType!==T.END_EVENT?r.compRef===e.compRef?n.concat([e]):((t&&e.closestPoint<r.closestPoint||!t&&e.closestPoint>r.closestPoint)&&n.splice(n.length-1,1,e),n):n.concat(e.eventType===T.START_EVENT?[e]:[])},[])}).value()}(g.partition(t,function(t){return g.includes(n[0].comps,t.compRef)}),e),o=[0,0],i=[[],[]],u=-1/0;o[0]<r[0].length||o[1]<r[1].length;){var c=o[0]===r[0].length||o[1]===r[1].length?o[0]===r[0].length?1:0:r[0][o[0]].coordinate<=r[1][o[1]].coordinate?0:1,a=r[c][o[c]++];if(a.eventType!==T.END_EVENT){i[c].push(a);var s=[g.maxBy(i[0],"closestPoint"),g.minBy(i[1],"closestPoint")],f=g.get(s,[1,"closestPoint"])-g.get(s,[0,"closestPoint"]);!g.isNaN(f)&&f>u&&(u=f)}else g.remove(i[c],{compRef:a.compRef})}return u}function f(n,t){return g.transform(n,function(n,e){var r=g.findIndex(t,function(n){return g.includes(n.comps,e.compRef)});return n[r]=(n[r]||[]).concat([e]),n},[])}function l(n,t){var e=f(n.x,t),r=f(n.y,t);return g.map(g.keys(t),function(n){return g.assign({},{x:e[n],y:r[n]})})}function p(n,t,e){return function(n,t,e){var r=null;return g.forEach(D,function(o,i){if(!e[i])return!0;var u=o(t.y,n,"y"),c=o(t.x,n,"x");return null===(r=u&&c?null:u||c)}),r}(n,t,e)||function(n,t){var e=g.size(t.x)>1?a(t.x,n,"x"):null,r=g.size(t.y)>1?a(t.y,n,"y"):null;if(e&&r){var o=R.HORIZONTAL*e.maxCompsDistance>R.VERTICAL*r.maxCompsDistance?e:r;return g.pick(o,["fragments","fragmentsEvents"])}return e||r}(n,t)}function m(n,t,e,r){if(g.size(t)<2)return t||[];var o=g.mapValues(e,c);if(1===g.size(o.x)&&1===g.size(o.y))return r.detectSemanticGroups?r.useOverlapRules?function(n,t){t=Object(E.h)(n,t);var e="overlayGroup_"+(t=g.sortBy(t,"layout.y"))[0].id;return g.forEach(t,function(n){return g.set(n,["conversionData","overlayGroupId"],e)}),t}(n,t):function(n,t,e){var r=function(n){return g.some(n,"conversionData.originalLayout")};if(r(t)||g.some(t,function(n){return r(n)}))return v(t),t;d(t);var o=u(t,"y"),i=u(t,"x"),c=m(n,t,{y:o,x:i},e);return v(c),c}(n,t,r):Object(E.h)(n,t);var i=p(e,o,{mirrorPattern:r.detectSemanticGroups,chessPattern:r.detectSemanticGroups,verticalDivider:!0,singleCompRow:!0});return 1===g.size(i.fragments)?i.fragments[0].comps:g.flatMap(i.fragments,function(t,e){return m(n,t.comps,i.fragmentsEvents[e],r)})}function d(n){g.forEach(n,function(n){var t=n.layout,e=g.assign(h.objectUtils.cloneDeep(t),{height:t.height*_,width:t.width*_});n.layout=e,g.set(n,["conversionData","originalLayout"],t)})}function v(n,t){void 0===t&&(t=!0),g.forEach(n,function(n){var t=g.get(n,["conversionData","originalLayout"]);t&&(n.layout=h.objectUtils.cloneDeep(t),delete n.conversionData.originalLayout)}),t&&g.forEach(n,function(n){return v(n.components,!1)})}function y(n,t,e){var r=m(n,t,{y:u(t,"y"),x:u(t,"x")},e);n.conversionData.componentsOrder=g.map(r,"id")}e.d(t,"a",function(){return u}),e.d(t,"b",function(){return c}),e.d(t,"c",function(){return y});var g=e(0),E=e(3),h=e(4),T={START_EVENT:"start",END_EVENT:"end"},_=.9,R={HORIZONTAL:1,VERTICAL:1.25},D={singleCompRow:function(n,t,e){if("x"===e)return null;var o=g.findIndex(n,function(n){return 1===g.size(n.comps)});if(-1===o)return null;var i=r(n,function(n){return Object(E.e)(n-o)+Object(E.e)(o)});return{type:"singleCompRow",fragments:i,fragmentsEvents:l(t,i)}},verticalDivider:function(n,t,e){if(g.size(n)<3||g.every(n,function(n){return 1===g.size(n.comps)})||"y"===e)return null;var o=function(n,t){var e=g(t.y).partition({eventType:T.START_EVENT}).map(function(n){return g.map(n,"coordinate")}).value(),r=g.max(e[0]),o=g.min(e[1]);return g.findIndex(n,function(n){var t=n.comps[0];return 1===n.comps.length&&t.conversionData.keepIfVerticalDivider&&t.layout.y<=o&&Object(E.b)(t,"y")>=r})}(n,t);if(-1===o)return null;g.set(n[o].comps[0],["conversionData","isVerticalDivider"],!0);var i=r(n,function(n){return Object(E.e)(n-o)+Object(E.e)(o)});return{type:"verticalDivider",fragments:i,fragmentsEvents:l(t,i)}},mirrorPattern:function(n,t,e){if(g.size(n)<2)return null;var r=l(t,n),i=x(e),u=g.map(r,function(n){return N(n[i])}),c=g.every(u,function(n){return Object(E.a)(n,u[0],i)});return c&&c?o(g.flatten(u),t,{type:"mirrorPattern"}):null},chessPattern:function(n,t,e){if("y"!==e||g.size(n)<2||!g.every(n,function(n){return 2===g.size(n.comps)}))return null;var r=l(t,n),i=g.map(r,function(n){return N(n.x)}),u=g.flatMap(i,function(n,t){return I(t)?n:g.reverse(n)}),c=u[0].conversionData.category,a="text"===c?"photo":"text";return g.every(u,function(n,t){return n.conversionData.category===(I(t)?c:a)})?o(u,t,{type:"chessPattern"}):null}},N=function(n){return g(n).map("compRef").uniq().value()},x=function(n){return"x"===n?"y":"x"},I=function(n){return n%2==0};E.h},function(n,t,e){"use strict";function r(n,t){var e=a.a(n,t);return a.b(e)}function o(n){if(c.size(n)<=1)return n;var t=c.map(r(n,"y"),"comps");return c.reduce(t,function(t,e){if(1===c.size(e))return t.concat(e);var o=c.map(r(e,"x"),"comps"),i=c.flatMap(o,function(t){return 1===c.size(t)?t:c.sortBy(t,c.findIndex.bind(null,n))});return t.concat(i)},[])}function i(n){var t=u.getChildren(n);if(!t)return{};var e=o(t),r=c.set({},n.id,c.map(e,"id")),a=c.map(t,i);return c.assign.apply(c,[r].concat(a))}e.r(t);var u=e(1),c=e(0),a=e(5);e.d(t,"translateComponents",function(){return u.translateComps}),e.d(t,"getSnugLayout",function(){return u.getSnugLayout}),e.d(t,"splitToFragments",function(){return r}),e.d(t,"sortSiblings",function(){return o}),e.d(t,"getComponentsOrder",function(){return i})}])});