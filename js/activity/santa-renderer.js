define(["lodash","prop-types","react","mobx"],function(e,t,n,r){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=14)}([function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t){e.exports=n},function(e,t){e.exports=r},function(e,t,n){"use strict";e.exports={create:function(e){var t=e.displayedDAL,n=e.pointers;return{Fonts:{fontsMap:function(){return t.get(n.data.getThemeDataPointer()).font}},Component:{structure:function(e,t){return t.structure.toJS()},id:function(e,t){return t.id},styleId:function(e,t){return t.structure.styleId},style:function(e,t){var n=t.structure.layout;return{width:n.width,height:n.height,top:n.y,left:n.x,position:"absolute"}},skin:function(e,r){var o=r.structure;return o.styleId&&(t.get(n.data.getStylePointer(o.styleId))||{}).skin||o.skin},compData:function(e,r){var o=r.compData,i=r.structure.dataQuery;if(o)return o;if(!i)return null;var s=n.data.getDataPointer(i);return t.get(s)},compProp:function(e,r){var o=r.compProp,i=r.structure.propertyQuery;if(o)return o;if(!i)return{};var s=n.data.getPropertiesPointer(i);return t.get(s)},compActions:function(){return{}}}}}}},function(e,t,n){"use strict";var r=n(0),o={COMPONENT_PROPERTY:{COMPONENTS:"components",COMPONENT_TYPE:"componentType",CONNECTION_QUERY:"connectionQuery",DATA_QUERY:"dataQuery",ID:"id",LAYOUT:"layout",MOBILE_HINTS_QUERY:"mobileHintsQuery",MODES:"modes",PROPERTY_QUERY:"propertyQuery",SKIN:"skin",STYLE_ID:"styleId",PARENT:"parent",TYPE:"type"},DATA:{BEHAVIORS:"behaviors_data",CONNECTIONS:"connections_data",DATA:"document_data",DESIGN:"design_data",MOBILE_HINTS:"mobile_hints",PROPERTIES:"component_properties",STYLE:"theme_data"}},i=r.mapValues(o.DATA,function(e,t){return t}),s=r.invert(o.COMPONENT_PROPERTY),u=function(e){return function(t){return{id:t.replace("#",""),type:e}}};e.exports={components:{getComponent:u("COMPONENT"),getProperty:function(e,t){var n=s[t];if("COMPONENT"!==e.type||!n)throw new Error("pointer must be a component pointer or invalid property name");return{id:e.id,type:n}},PROPERTY_TYPES:o.COMPONENT_PROPERTY},data:{getBehaviorsPointer:u(i.BEHAVIORS),getConnectionsPointer:u(i.CONNECTIONS),getDataPointer:u(i.DATA),getDesignPointer:u(i.DESIGN),getMobileHintsPointer:u(i.MOBILE_HINTS),getPropertiesPointer:u(i.PROPERTIES),getStylePointer:u(i.STYLE),getThemeDataPointer:function(){return u(i.STYLE)("THEME_DATA")}},getPath:function(e){var t=e.id,n=e.type;if("COMPONENT"===n)return["structure",t];var i=r.get(o.COMPONENT_PROPERTY,n);if(i)return["structure",t,i];var s=r.get(o.DATA,n);if(s)return["data",s,t];throw new Error("Invalid pointer Type "+n)}}},function(e,t,n){"use strict";var r=n(0),o=function(e,t){return e.getPath(t)},i=function(e,t,n){return r.get(e,o(t,n))},s=function(e,t,n,i){r.set(e,o(t,n),i)};e.exports={create:function(e,t){var n=t.pointers;return{get:function(t){return i(e,n,t)},getKeys:function(t){var o=i(e,n,t);return r.keys(o)},isExist:function(t){return r.has(e,o(n,t))},merge:function(t,o){var u=i(e,n,t),c=r.assign({},u,o);s(e,n,t,c)},push:function(t,r,o){var u=i(e,n,t);o=o||u.length,u.splice(o,0,r),s(e,n,t,u)},remove:function(t){var i=o(n,t),s=i.pop();delete r.get(e,i)[s]},set:function(t,r){return s(e,n,t,r)}}}}},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(0),i=n(6),s=n(5),u=n(4),c=new WeakMap,a=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var n={jsonModel:t};this.pointers=s,this.displayedDAL=i.create(n.jsonModel,this),n.propsFetcher=u.create(this),c.set(this,n)}return r(e,[{key:"getFetcher",value:function(e){var t=c.get(this).propsFetcher;return o.get(t,e.id)}}]),e}();e.exports=a},function(e,t,n){"use strict";var r=n(0),o=n(2),i=n(1),s=function(e,t){var n=e.id,i=t.componentsModelAspect,s=t.getCompClass,u=t.rootId,c=i.displayedDAL,a=i.pointers,p=a.components.getComponent(n),f=c.get(a.components.getProperty(p,"styleId")),d=f&&c.get(a.data.getStylePointer(f))||{},l=r.get(d,"skin")||c.get(a.components.getProperty(p,"skin"));if(d=r.defaults({skin:l},d),!l)return null;var y=s(c.get(a.components.getProperty(p,"componentType")));if(!y||!y.getCompCss)return null;var m=function(e){var t=e.displayedDAL,n=e.pointers;return{themeData:t.get(n.data.getThemeDataPointer()),reportMissingSkin:r.noop}}(i),g=y.getCompCss(f,d,m);return o.createElement("style",{id:f,type:"text/css","data-styleid":f,dangerouslySetInnerHTML:{__html:u?function(e,t){var n=t.trim().split("\n");return r(n).map(function(t){var n=t.split("{"),o=n[0].split(",");return o[0]=o[0].trimLeft(),n[0]=r.map(o,function(t){return"#"+e+" "+t}),n.join("{")}).join("\n")}(u,g):g||""}})};s.displayName="ComponentStyleNode",s.propTypes={id:i.string.isRequired},s.contextTypes={getCompClass:i.func.isRequired,componentsModelAspect:i.shape({pointers:i.object.isRequired,displayedDAL:i.object.isRequired}).isRequired,rootId:i.string},e.exports=s},function(e,t,n){"use strict";function r(e,t){var n=e.id,r=e.pointers,o=e.displayedDAL,i=r.components.getComponent(n);if(!o.isExist(i))return null;var s=r.components.getProperty(i,t);return o.get(s)}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(3),s=new WeakMap,u=function(e,t){return i.computed(function(){return r(e,t)},{compareStructural:!0,name:"MagicStructure_"+e.id+"_"+t})},c=function(){function e(t,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var i={id:t,displayedDAL:n,pointers:o};i.layout=u(i,"layout"),i.modes=u(i,"modes"),s.set(this,i),this.id=t,this.type=r(i,"type")}return o(e,[{key:"toJS",value:function(){var e=s.get(this),t=e.displayedDAL,n=e.pointers,r=e.id;return t.get(n.components.getComponent(r))}},{key:"componentType",get:function(){return r(s.get(this),"componentType")}},{key:"dataQuery",get:function(){return r(s.get(this),"dataQuery")}},{key:"propertyQuery",get:function(){return r(s.get(this),"propertyQuery")}},{key:"skin",get:function(){return r(s.get(this),"skin")}},{key:"styleId",get:function(){return r(s.get(this),"styleId")}},{key:"layout",get:function(){return s.get(this).layout.get()}}]),e}();e.exports=c},function(e,t,n){"use strict";function r(e,t,n,r){var o=function(e){return{fetchSantaType:e.fetchSantaType}}(e),s=function(e,t){return i.defaults({structure:e,id:e.id},t)}(n,r);return i(t).thru(a).mapValues(function(t){return e.fetchSantaType(t,o,s)}).defaults(r).value()}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(0),s=n(2),u=n(1),c=n(9),a=i.memoize(function(e){return i.pickBy(e.propTypes,"id")}),p=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),o=n.componentsModelAspect,i=o.displayedDAL,s=o.pointers;return r.magicStructure=new c(e.id,i,s),n.onRenderStart(e.id),r.registerComponent=function(e){r.context.registerComponent(r.props.id,e)},r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.Component),o(t,[{key:"componentDidCatch",value:function(e){this.context.onRenderError(this.props.id,e)}},{key:"componentDidMount",value:function(){this.isReactClass||this.registerComponent(this),this.context.onRenderEnd(this.props.id)}},{key:"componentWillUpdate",value:function(){this.context.onRenderStart(this.props.id)}},{key:"componentDidUpdate",value:function(){this.context.onRenderEnd(this.props.id)}},{key:"componentWillUnmount",value:function(){this.isReactClass||this.registerComponent(null)}},{key:"render",value:function(){var e=this.context.getCompClass(this.magicStructure.componentType);if(!e)return s.createElement("div",{id:this.magicStructure.id,"data-dead-comp":!0});var t=r(this.context,e,this.magicStructure,this.props);return this.isReactClass=this.isReactClass||i.hasIn(e,"prototype.isReactComponent"),this.isReactClass?s.createElement(e,i.defaults({ref:this.registerComponent},t)):s.createElement(e,t)}}]),t}();p.displayName="PropsResolver",p.propTypes={id:u.string.isRequired},p.contextTypes={getCompClass:u.func.isRequired,fetchSantaType:u.func.isRequired,getAspect:u.func.isRequired,onRenderStart:u.func.isRequired,onRenderEnd:u.func.isRequired,onRenderError:u.func.isRequired,registerComponent:u.func.isRequired,componentsModelAspect:u.shape({pointers:u.object.isRequired,displayedDAL:u.object.isRequired}).isRequired},e.exports=p},function(e,t,n){"use strict";var r=n(2),o=n(1),i=n(10),s=n(8),u=function(e,t){var n=e.id,o=t.componentsModelAspect,u=o.displayedDAL,c=o.pointers,a=r.createElement(s,{id:n,key:"style"}),p=c.components.getComponent(n),f=c.components.getProperty(p,"components");return u.isExist(f)?null:[a,r.createElement(i,{id:n,key:"comp"})]};u.propTypes={id:o.string.isRequired},u.contextTypes={componentsModelAspect:o.shape({pointers:o.object.isRequired,displayedDAL:o.object.isRequired}).isRequired},e.exports=u},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(0),i=n(2),s=n(1),u=n(11),c=n(7),a=new WeakMap,p=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),r=e.aspects.componentsModelAspect||new c(e.componentsModel);return a.set(n,{componentsModelAspect:r,aspects:o.defaults(e.aspects,{componentsModelAspect:r}),fetchSantaType:function(e,t,n){var r=a.get(this).componentsModelAspect,o=this.props.getSantaFetcher(e)||r.getFetcher(e);return o?o(t,n):null}.bind(n)}),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.Component),r(t,[{key:"render",value:function(){var e=o(t.propTypes).keys().without("id").value(),n=o.omit(this.props,e);return i.createElement("div",n,o.map(this.props.rootCompsIds,function(e){return i.createElement(u,{id:e,key:e})}))}},{key:"getChildContext",value:function(){var e=a.get(this),t=e.componentsModelAspect,n=e.fetchSantaType,r=e.aspects;return{rootId:this.props.id,componentsModelAspect:t,fetchSantaType:n,getAspect:function(e){return r[e]},getCompClass:this.props.getCompClass,onRenderStart:function(){},onRenderEnd:function(){},onRenderError:function(){},registerComponent:function(){}}}}]),t}();p.defaultProps={getSantaFetcher:o.noop,aspects:{}},p.displayName="Renderer",p.propTypes={eventsManager:s.shape({on:s.func.isRequired,off:s.func.isRequired,emit:s.func.isRequired}),componentsModel:s.shape({structure:s.object.isRequired,data:s.object.isRequired}),getCompClass:s.func.isRequired,getSantaFetcher:s.func.isRequired,aspects:s.object,rootCompsIds:s.arrayOf(s.string.isRequired),id:s.string},p.childContextTypes={getCompClass:s.func.isRequired,fetchSantaType:s.func.isRequired,getAspect:s.func.isRequired,onRenderStart:s.func.isRequired,onRenderEnd:s.func.isRequired,onRenderError:s.func.isRequired,registerComponent:s.func.isRequired,componentsModelAspect:s.shape({pointers:s.object.isRequired,displayedDAL:s.object.isRequired}).isRequired,rootId:s.string},e.exports=p},function(e,t,n){"use strict";var r=n(0),o=n(3);e.exports={getStorage:function(){var e=o.observable.shallowMap();return{transaction:o.runInAction,set:function(t,n){e.set(t,n)},update:function(t,n){var o=e.get(t),i=r.defaults(n,o);return e.set(t,i),i},get:function(t){return e.get(t)},remove:function(t){return e.delete(t)},getAll:function(){return o.toJS(e)},clear:function(){e.clear()}}}}},function(e,t,n){"use strict";var r=n(13),o=n(12);e.exports={utils:{storageAPI:r},Renderer:o}}])});